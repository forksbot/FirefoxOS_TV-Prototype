{"version":3,"sources":["../../app/scripts/edit.js"],"names":[],"mappings":"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","file":"edit.js","sourcesContent":["/* global evt, Folder, SmartModalDialog, Utils */\n\n'use strict';\n\n(function(exports) {\n  const EDIT_MODE_SCALE = 0.57;\n  const CARD_TRANSFORM_LATENCY = 500;\n\n  /**\n   * Edit is the controller class when smart-home is in edit mode.\n   *\n   * @class Edit\n   */\n  function Edit() {}\n\n  Edit.prototype = evt({\n    mainSection: document.getElementById('main-section'),\n    doneButton: document.getElementById('done-button'),\n    searchButton: document.getElementById('search-button'),\n    addNewFolderButton: document.getElementById('add-new-folder-button'),\n    editButton: document.getElementById('edit-button'),\n    settingsButton: document.getElementById('settings-button'),\n\n    regularNavElements: undefined,\n    editNavElements: undefined,\n    currentNode: undefined,\n\n    init: function(spatialNavigator, cardManager,\n                   cardScrollable, folderScrollable) {\n      var that = this;\n      this.modalDialog = new SmartModalDialog();\n\n      this.spatialNavigator = spatialNavigator;\n      this.cardManager = cardManager;\n      this.cardScrollable = cardScrollable;\n      this.folderScrollable = folderScrollable;\n\n      this.regularNavElements =\n              [this.searchButton, this.settingsButton, this.editButton];\n      this.editNavElements = [this.doneButton, this.addNewFolderButton];\n\n      this.cardManager.on('card-swapped', this.onCardSwapped.bind(this));\n      this.cardManager.getCardList().then(function(cardList) {\n        cardList.forEach(function(card) {\n          if (card instanceof Folder) {\n            card.on('card-swapped', that.onCardSwapped.bind(that));\n          }\n        });\n      });\n\n      this.cardScrollable.on('listTransformEnd',\n                                  this.handleListTransformEnd.bind(this));\n      this.cardScrollable.on('nodeTransformEnd',\n        this.onCardMoveAnimationEnd.bind(this));\n      this.cardScrollable.on('hovering-node-removed',\n        this.onHoveringNodeRemoved.bind(this));\n      this.cardScrollable.on('node-inserted-over-folder',\n        this.onNodeInsertedOverFolder.bind(this));\n\n      this.spatialNavigator.on('focus', this.handleFocus.bind(this));\n      this.spatialNavigator.on('unfocus', this.handleUnfocus.bind(this));\n\n      // A workaround for checking if the folder list is navigable\n      this.isFolderReady = false;\n      // The hovering card\n      this._hoveringCard = null;\n    },\n    /**\n     * State of home app looks like this:\n     * (normal state)<-->Edit mode<-->Arrange mode\n     * (Only adjacant states are switchable)\n     */\n    toggleEditMode: function() {\n      if (this.mainSection.dataset.mode === 'edit') {\n        this.mainSection.dataset.mode = '';\n        this.spatialNavigator.multiAdd(this.regularNavElements);\n        this.spatialNavigator.multiRemove(this.editNavElements);\n        this.cardScrollable.setScale();\n        this.folderScrollable.setScale();\n        this.cardScrollable.listElem.classList.add('exiting-edit-mode');\n        this.cardManager.writeCardlistInCardStore({cleanEmptyFolder: true})\n          .then(function() {\n            // Since writeCardlistInCardStore triggers card-removed event that\n            // causes re-focus on other elements in card list, we need to wait\n            // until those actions to be done before focusing editButton.\n            this.spatialNavigator.focus(this.editButton);\n            this.currentNode.classList.remove('focused');\n          }.bind(this));\n        this._concealPanel(this.currentScrollable, this.currentNode);\n        this.fire('exit-edit-mode');\n      } else {\n        this.mainSection.dataset.mode = 'edit';\n        this.spatialNavigator.multiRemove(this.regularNavElements);\n        this.spatialNavigator.multiAdd(this.editNavElements);\n\n        this._setCurrentScrollable(this.cardScrollable);\n        this.currentNode =\n          this.cardScrollable.getNodeFromItem(this.cardScrollable.currentItem);\n        this._revealPanel(this.currentScrollable, this.currentNode);\n\n        this.spatialNavigator.focus(this.cardScrollable);\n        this.cardScrollable.setScale(EDIT_MODE_SCALE);\n        this.folderScrollable.setScale(EDIT_MODE_SCALE);\n        this.fire('enter-edit-mode');\n      }\n    },\n\n    toggleArrangeMode: function() {\n      if (this.mainSection.dataset.mode === 'edit') {\n        this.mainSection.dataset.mode = 'arrange';\n        this._concealPanel(this.currentScrollable, this.currentNode);\n        this.currentScrollable.focus(this.currentScrollable.currentItem);\n        this._setHintArrow();\n        if (this.currentScrollable === this.folderScrollable) {\n          this.cardScrollable.setColspanOnFocus(1);\n        }\n        this.fire('arrange');\n      } else if (this.mainSection.dataset.mode == 'arrange') {\n        this.mainSection.dataset.mode = 'edit';\n\n        this.currentNode = this.currentScrollable.getNodeFromItem(\n                                            this.currentScrollable.currentItem);\n        this._revealPanel(this.currentScrollable, this.currentNode);\n        this._clearHintArrow();\n        this.cardScrollable.setColspanOnFocus(0);\n        this.folderScrollable.realignToReferenceElement();\n      }\n    },\n\n    _moveQueue: {\n      queue: [],\n      isEmpty: function() {\n        return (this.queue.length === 0);\n      },\n      push: function(obj) {\n        this.queue.push(obj);\n      },\n      shift: function() {\n        return this.queue.shift();\n      },\n      getLength: function() {\n        return this.queue.length;\n      },\n      clearQueue: function() {\n        this.queue.length = 0;\n      }\n    },\n\n    _moveTimer: undefined,\n\n    _produceMove: function(key) {\n      this._moveQueue.push(key);\n      if (!this._moveTimer) {\n        this._consumeMove();\n      }\n    },\n\n    _consumeMove: function() {\n      var focus = this.spatialNavigator.getFocusedElement();\n\n      if (!this._moveQueue.isEmpty() && focus.CLASS_NAME === 'XScrollable') {\n        var key = this._moveQueue.shift();\n        var targetItem = focus.getTargetItem(key);\n\n        switch (key) {\n        case 'left':\n        case 'right':\n          if (!focus.isHovering && targetItem &&\n              focus.currentItem.getAttribute('app-type') !== 'deck' &&\n              focus.currentItem.getAttribute('app-type') !== 'folder' &&\n              targetItem.getAttribute('app-type') === 'folder') {\n            // hover on folder\n            this.hoverCard(focus, focus.currentItem, targetItem);\n            this._moveTimer =\n              window.setTimeout(this.onCardMoveAnimationEnd.bind(this),\n                CARD_TRANSFORM_LATENCY, targetItem);\n          } else if (focus.isHovering && targetItem !== focus.hoveredItem) {\n            this.unhoverCard(focus, true);\n            this._moveTimer =\n              window.setTimeout(this.onCardMoveAnimationEnd.bind(this),\n                CARD_TRANSFORM_LATENCY, targetItem);\n          } else if (targetItem) {\n            if (focus.isHovering) {\n              this.unhoverCard(focus, false);\n            }\n            var focusedCard = this.cardManager.findCardFromCardList(\n                                    {cardId: focus.currentItem.dataset.cardId});\n            var nonFocusedCard = this.cardManager.findCardFromCardList(\n                                      {cardId: targetItem.dataset.cardId});\n            if (this.currentScrollable === this.folderScrollable) {\n              var containingFolder = this.cardManager.findContainingFolder(\n                                    {cardId: focus.currentItem.dataset.cardId});\n              containingFolder.swapCard(focusedCard, nonFocusedCard);\n            } else {\n              this.cardManager.swapCard(focusedCard, nonFocusedCard);\n            }\n\n            this._moveTimer =\n              window.setTimeout(this.onCardMoveAnimationEnd.bind(this),\n                CARD_TRANSFORM_LATENCY, targetItem);\n          } else {\n            // if queue is not empty but we are failed to get targetItem\n            // that means we reach the boundary of cards. Thus we should\n            // consume next action in queue\n            this._consumeMove();\n          }\n\n          break;\n        case 'down':\n          if (focus.isHovering && this.isFolderReady) {\n            this.moveToFolder();\n            this._moveTimer =\n              window.setTimeout(this.onCardMoveAnimationEnd.bind(this),\n              CARD_TRANSFORM_LATENCY);\n          }\n          this._moveQueue.clearQueue();\n          break;\n        case 'up':\n          if (this.currentScrollable === this.folderScrollable) {\n            this.moveToCardList(focus);\n            this._moveTimer =\n              window.setTimeout(this.onCardMoveAnimationEnd.bind(this),\n              CARD_TRANSFORM_LATENCY);\n          }\n          break;\n        }\n      }\n    },\n\n    onCardMoveAnimationEnd: function(elem) {\n      if (this._moveTimer) {\n        window.clearTimeout(this._moveTimer);\n        this._moveTimer = undefined;\n      }\n      if (elem &&\n          !elem.classList.contains('focused') &&\n          !this._moveQueue.isEmpty()) {\n        this._consumeMove();\n      }\n    },\n\n    onCardSwapped: function(card1, card2, idx1, idx2) {\n      this.currentScrollable.swap(idx1, idx2);\n      this._setHintArrow();\n    },\n\n    onMove: function(key) {\n      if (this.modalDialog.isOpened) {\n        return true;\n      }\n\n      if (this.mode !== 'arrange') {\n        return false;\n      }\n      this._produceMove(key);\n\n      return true;\n    },\n\n    _setHintArrow: function(scrollable) {\n      var index = parseInt(this.currentNode.dataset.idx, 10);\n      if (scrollable && scrollable.isHovering) {\n        this.currentNode.classList.toggle('left_arrow', true);\n        this.currentNode.classList.toggle('right_arrow', true);\n        this.currentNode.classList.toggle('down_arrow', true);\n        this.currentNode.classList.remove('up_arrow');\n      } else {\n        this.currentNode.classList.toggle('left_arrow', index > 0);\n        this.currentNode.classList.toggle('right_arrow',\n                                    index < this.currentScrollable.length - 1);\n        this.currentNode.classList.remove('down_arrow');\n        this.currentNode.classList.toggle('up_arrow',\n                              this.currentScrollable === this.folderScrollable);\n      }\n    },\n\n    _setCurrentScrollable: function(scrollable) {\n      this.currentScrollable = scrollable;\n      document.getElementById('card-viewer').classList.toggle(\n        'current-scrollable', scrollable === this.cardScrollable);\n      document.getElementById('folder-viewer').classList.toggle(\n        'current-scrollable', scrollable === this.folderScrollable);\n    },\n\n    _clearHintArrow: function() {\n      this.currentNode.classList.remove('left_arrow');\n      this.currentNode.classList.remove('right_arrow');\n    },\n\n    addNewFolder: function() {\n      var folder = this.cardManager.insertNewFolder({id: 'new-folder'},\n        this.cardScrollable.currentIndex);\n      folder.on('card-swapped', this.onCardSwapped.bind(this));\n      this.spatialNavigator.focus(this.cardScrollable);\n    },\n\n    moveToFolder: function() {\n      // Remove the card from the main list\n      this.cardManager.removeCard(this._hoveringCard);\n    },\n\n    /**\n     * Runs after moveToFolder call, when the hovering card is successfully\n     * removed by cardManager and the node is removed from cardScrollable.\n     */\n    onHoveringNodeRemoved: function(cardItem, folderItem) {\n      var card = this._hoveringCard;\n      var folder = this.cardManager.findCardFromCardList(\n                    {cardId: folderItem.dataset.cardId});\n      // Add the card into the folder\n      folder.addCard(card, this.folderScrollable.isReversed ? null : 0);\n      this._hoveringCard = null;\n      this._setCurrentScrollable(this.folderScrollable);\n      this.folderScrollable.realignToReferenceElement();\n      this.currentNode = this.folderScrollable.getNodeFromItem(\n                                            this.folderScrollable.currentItem);\n      if (!this.spatialNavigator.focus(this.folderScrollable)) {\n        // When a card is added to a new empty folder,\n        // add the folderScrollable to this.spatialNavigator.\n        this.spatialNavigator.add(this.folderScrollable);\n        this.spatialNavigator.focus(this.folderScrollable);\n      }\n      this._setHintArrow();\n    },\n\n    moveToCardList: function(focus) {\n      var folder = this.cardManager.findContainingFolder(\n                                    {cardId: focus.currentItem.dataset.cardId});\n      var card = this.cardManager.findCardFromCardList(\n                                    {cardId: focus.currentItem.dataset.cardId});\n      var folderItem = this.cardScrollable.currentItem;\n      var idx = this.cardScrollable.getNodeFromItem(folderItem).dataset.idx;\n\n      this._hoveringCard = card;\n\n      folder.removeCard(card);\n\n      // insert card\n      this.cardManager.insertCard({\n        card: card,\n        index: parseInt(idx, 10),\n        overFolder: true\n      });\n    },\n\n    onNodeInsertedOverFolder: function() {\n      this.spatialNavigator.focus(this.cardScrollable);\n      this._setCurrentScrollable(this.cardScrollable);\n      this.currentNode = this.cardScrollable.getNodeFromItem(\n                                            this.cardScrollable.currentItem);\n      this._setHintArrow(this.currentScrollable);\n      this.folderScrollable.realignToReferenceElement();\n    },\n\n    onEnter: function() {\n      if (this.mode !== 'edit' && this.mode !== 'arrange') {\n        return false;\n      }\n\n      if (this.modalDialog.isOpened) {\n        return true;\n      }\n\n      var focus = this.spatialNavigator.getFocusedElement();\n      if (focus === this.doneButton) {\n        this.toggleEditMode();\n      } else if (focus === this.addNewFolderButton) {\n        this.addNewFolder();\n      } else if (focus.CLASS_NAME === 'XScrollable') {\n        var currentItem = focus.currentItem;\n\n        if (currentItem.classList.contains('rename-btn')) {\n          this.renameCard(focus, focus.getNodeFromItem(currentItem));\n        } else if (currentItem.classList.contains('delete-btn')) {\n          this.openDeleteCardDialog(focus, focus.getNodeFromItem(currentItem));\n        } else if (currentItem.classList.contains('hover')) {\n          // When a card is hovering over a folder, do nothing here.\n        } else {\n          // Current focus is on a card\n          this.toggleArrangeMode();\n        }\n      }\n      return true;\n    },\n\n    renameCard: function(scrollable, nodeElem) {\n      var card = this.cardManager.findCardFromCardList({\n        cardId: scrollable.getItemFromNode(nodeElem).dataset.cardId\n      });\n      var _ = navigator.mozL10n.get;\n\n      var lang = document.documentElement.lang;\n      var oldName = this.cardManager.resolveCardName(card, lang);\n      oldName = oldName.raw ? oldName.raw : _(oldName.id);\n\n      var result = prompt(_('enter-new-name'), oldName);\n      if (!result) {\n        return;\n      }\n      card.name = {raw: result};\n      this.cardManager.updateCard(card);\n    },\n\n    openDeleteCardDialog: function(scrollable, nodeElem) {\n      Utils.holdFocusForAnimation();\n      this.modalDialog.open({\n        message: {\n          textL10nId: 'delete-card-alert'\n        },\n        buttonSettings: [\n          {\n            textL10nId: 'cancel',\n            defaultFocus: true,\n            onClick: this.spatialNavigator.focus.bind(this.spatialNavigator)\n          },\n          {\n            textL10nId: 'delete',\n            class: 'danger',\n            onClick: this.deleteCard.bind(this, scrollable, nodeElem)\n          }\n        ],\n        onCancel: this.spatialNavigator.focus.bind(this.spatialNavigator)\n      });\n    },\n\n    deleteCard: function(scrollable, nodeElem) {\n      var itemElem = scrollable.getItemFromNode(nodeElem);\n      this._concealPanel(scrollable, nodeElem);\n      nodeElem.classList.add('delete');\n\n      if (scrollable === this.folderScrollable) {\n        var folder = this.cardManager.findContainingFolder(\n                          {cardId: itemElem.dataset.cardId});\n        var card = this.cardManager.findCardFromCardList(\n                          {cardId: itemElem.dataset.cardId});\n      }\n\n      var deletedItem = scrollable.getItemFromNode(nodeElem);\n      deletedItem.addEventListener('transitionend', function(evt) {\n        if (evt.propertyName === 'transform') {\n          scrollable.spatialNavigator\n                    .focus(scrollable.getItemFromNode(nodeElem));\n          if (scrollable === this.cardScrollable) {\n            this.cardManager.removeCard(parseInt(nodeElem.dataset.idx, 10));\n          } else {\n            folder.removeCard(card);\n\n            if (folder.isEmpty()) {\n              this.spatialNavigator.focus(this.cardScrollable);\n            }\n          }\n        }\n      }.bind(this));\n    },\n\n    hoverCard: function(scrollable, focusedItem, targetItem) {\n      var card = this.cardManager.findCardFromCardList(\n                      {cardId: focusedItem.dataset.cardId});\n      this._hoveringCard = card;\n      scrollable.hover(focusedItem, targetItem);\n      // set up/bottom arrow\n      this._setHintArrow(scrollable);\n    },\n\n    unhoverCard: function(scrollable, shouldResetCardPositions) {\n      scrollable.unhover(shouldResetCardPositions);\n      this._hoveringCard = null;\n      // clear up/bottom arrow\n      if (shouldResetCardPositions) {\n        this._setHintArrow();\n      }\n    },\n\n    _getPanel: function(nodeElem) {\n      var cardPanel = nodeElem.getElementsByClassName('card-panel')[0];\n      return {\n        panel: cardPanel,\n        renameBtn: cardPanel.getElementsByClassName('rename-btn')[0],\n        deleteBtn: cardPanel.getElementsByClassName('delete-btn')[0]\n      };\n    },\n\n    _revealPanel: function(scrollable, nodeElem) {\n      var panel = this._getPanel(nodeElem);\n      if(scrollable.getItemFromNode(nodeElem).getAttribute('app-type') ===\n                                                                  'deck') {\n        // Decks can't be renamed or deleted.\n        return;\n      }\n      scrollable.spatialNavigator.add(panel.renameBtn);\n      scrollable.spatialNavigator.add(panel.deleteBtn);\n    },\n\n    _concealPanel: function(scrollable, nodeElem) {\n      var panel = this._getPanel(nodeElem);\n      scrollable.spatialNavigator.remove(panel.renameBtn);\n      scrollable.spatialNavigator.remove(panel.deleteBtn);\n    },\n\n    handleFocus: function(elem) {\n      if (this.mode === 'edit' && elem.CLASS_NAME === 'XScrollable') {\n        this.handleCardFocus(\n                elem, elem.currentItem, elem.getNodeFromItem(elem.currentItem));\n      }\n    },\n\n    handleUnfocus: function(elem) {\n      if (this.mode === 'edit' && elem === this.currentScrollable) {\n        this._concealPanel(this.currentScrollable, this.currentNode);\n        this.currentScrollable.spatialNavigator.focusSilently(\n          this.currentScrollable.getItemFromNode(this.currentNode));\n      }\n    },\n\n    handleCardFocus: function(scrollable, itemElem, nodeElem) {\n      if (this.mode !== 'edit' ||\n          // When focus goes outside the scrollable and the last selected item\n          // is a panel button, we still focus back to the card corresponding to\n          // that button to keep track of the last focused card. But in this\n          // case we don't need any further action on UI view.\n          this.spatialNavigator.getFocusedElement() !== scrollable) {\n        return;\n      }\n      // If users are moving from card to panel button, they're under the same\n      // node element. We need to \"unfocus\" the node only when user really move\n      // to another card. So here we call handleCardUnfocus manually.\n      if (this.currentNode != nodeElem) {\n        this._concealPanel(this.currentScrollable, this.currentNode);\n\n        this.currentNode = nodeElem;\n        this._setCurrentScrollable(scrollable);\n      }\n      this._revealPanel(scrollable, nodeElem);\n      itemElem.focus();\n      nodeElem.classList.add('focused');\n    },\n\n    handleListTransformEnd: function() {\n      if (this.mode === '') {\n        this.cardScrollable.listElem.classList.remove('exiting-edit-mode');\n      }\n    },\n\n    get mode() {\n      return this.mainSection.dataset.mode;\n    }\n  });\n\n  exports.Edit = Edit;\n}(window));\n"]}